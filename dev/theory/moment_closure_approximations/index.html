<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Moment Closure Approximations · MomentClosure.jl</title><meta name="title" content="Moment Closure Approximations · MomentClosure.jl"/><meta property="og:title" content="Moment Closure Approximations · MomentClosure.jl"/><meta property="twitter:title" content="Moment Closure Approximations · MomentClosure.jl"/><meta name="description" content="Documentation for MomentClosure.jl."/><meta property="og:description" content="Documentation for MomentClosure.jl."/><meta property="twitter:description" content="Documentation for MomentClosure.jl."/><meta property="og:url" content="https://augustinas1.github.io/MomentClosure.jl/theory/moment_closure_approximations/"/><meta property="twitter:url" content="https://augustinas1.github.io/MomentClosure.jl/theory/moment_closure_approximations/"/><link rel="canonical" href="https://augustinas1.github.io/MomentClosure.jl/theory/moment_closure_approximations/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">MomentClosure.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Theory</span><ul><li><a class="tocitem" href="../moment_expansion_CME/">Moment Expansion (CME)</a></li><li><a class="tocitem" href="../moment_expansion_SDE/">Moment Expansion (SDE)</a></li><li class="is-active"><a class="tocitem" href>Moment Closure Approximations</a><ul class="internal"><li><a class="tocitem" href="#zero_closure"><span>Zero Closure</span></a></li><li><a class="tocitem" href="#normal_closure"><span>Normal Closure</span></a></li><li><a class="tocitem" href="#poisson_closure"><span>Poisson Closure</span></a></li><li><a class="tocitem" href="#log-normal_closure"><span>Log-normal Closure</span></a></li><li><a class="tocitem" href="#gamma_closure"><span>Gamma Closure</span></a></li><li><a class="tocitem" href="#derivative_matching"><span>Derivative Matching</span></a></li><li><a class="tocitem" href="#conditional_closures"><span>Conditional Closures</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../linear_mapping_approximation/">Linear Mapping Approximation</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/using_momentclosure/">Using MomentClosure</a></li><li><a class="tocitem" href="../../tutorials/using_momentclosure_SDE/">Moment Equations from SDEs</a></li><li><a class="tocitem" href="../../tutorials/common_issues/">Common Issues</a></li><li><a class="tocitem" href="../../tutorials/time-dependent_propensities/">Time-dependent Propensity Functions</a></li><li><a class="tocitem" href="../../tutorials/geometric_reactions+conditional_closures/">Geometrically Distributed Reaction Products and Conditional Closures</a></li><li><a class="tocitem" href="../../tutorials/P53_system_example/">P53 System Example</a></li><li><a class="tocitem" href="../../tutorials/derivative_matching_example/">Derivative Matching Example</a></li><li><a class="tocitem" href="../../tutorials/SIR_example/">SIR Model Example</a></li><li><a class="tocitem" href="../../tutorials/LMA_example/">LMA Example</a></li><li><a class="tocitem" href="../../tutorials/parameter_estimation_SDE/">Parameter Estimation of Diffusion Processes</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../api/momentclosure_api/">MomentClosure.jl API</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Theory</a></li><li class="is-active"><a href>Moment Closure Approximations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Moment Closure Approximations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/augustinas1/MomentClosure.jl/blob/main/docs/src/theory/moment_closure_approximations.md#L" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="moment_closure_approximations"><a class="docs-heading-anchor" href="#moment_closure_approximations">Moment Closure Approximations</a><a id="moment_closure_approximations-1"></a><a class="docs-heading-anchor-permalink" href="#moment_closure_approximations" title="Permalink"></a></h1><p>In the <a href="../moment_expansion_CME/">previous section</a>, we have shown that for a non-linear system an infinite hierarchy of coupled moment equations is obtained that cannot be solved directly and, therefore, needs to be truncated in an approximate way. This can be achieved using moment closure approximations (MAs), in which all moments above a certain order <span>$m$</span> are expressed in terms of <span>$m^{\text{th}}$</span> and lower order moments using various (usually distributional) assumptions [1]. Doing so enables us to effectively <em>close</em> the moment hierarchy, leading to a finite set of ODEs which can then be solved numerically. In this section, we present some the commonly used MA methods that are implemented in MomentClosure. Please see the <strong>Tutorials</strong> section for examples showing different MAs applied to a variety of systems.</p><h2 id="zero_closure"><a class="docs-heading-anchor" href="#zero_closure">Zero Closure</a><a id="zero_closure-1"></a><a class="docs-heading-anchor-permalink" href="#zero_closure" title="Permalink"></a></h2><p>The simplest MA is the &quot;central-moment-neglect&quot; MA (CMN-MA) [2], also referred to as &quot;zero-closure&quot; [3] or &quot;low dispersion moment closure&quot; [4], where CMN-MA at <span>$m^{\text{th}}$</span> order means that the moment equations are truncated by setting all <em>central moments</em> above order <span>$m$</span> to zero. For example, in the simple case of <span>$2$</span>nd order truncation, the moment equations for the means <span>$\mu_i$</span> and covariances <span>$C_{ij}$</span> become:</p><p class="math-container">\[\begin{align*}
    \frac{d \mu_i}{dt} &amp;= \sum_{r} S_{ir} \Big( a_r(\mathbf{μ}) + \frac{1}{2}\sum_{i_1, i_2} \frac{\partial^2  a_r({\mathbf{μ}})}{\partial n_{i_1} \partial n_{i_2}} M_{i_1, i_2} \Big), \\
    \frac{dC_{ij}}{dt} &amp;= \frac{dM_{\mathbf{0}_{i+, j+}}}{dt} \\
    &amp;= \frac{d\langle (n_{i}-\mu_i) (n_{j}-\mu_{j}) \rangle}{dt} = \\
    &amp;= \sum_r \Big[ S_{ir} \sum_k \frac{\partial a_r(\mathbf{μ})}{\partial n_k} C_{jk} + S_{jr} \sum_k \frac{\partial a_r(\mathbf{μ})}{\partial n_k} C_{ik} \\
    &amp;+ S_{ir}S_{jr} \Big( a_r(\mathbf{μ}) + \frac{1}{2} \sum_{k, l} \frac{\partial^2 a_r(\mathbf{μ})}{\partial n_{k} \partial n_{l}} C_{kl} \Big) \Big] \;.
\end{align*}\]</p><h2 id="normal_closure"><a class="docs-heading-anchor" href="#normal_closure">Normal Closure</a><a id="normal_closure-1"></a><a class="docs-heading-anchor-permalink" href="#normal_closure" title="Permalink"></a></h2><p>Another popular MA is the &quot;normal moment-closure&quot;, pioneered by Goodman [5] and Whittle [6], where all <em>cumulants</em> <span>$\kappa_{\mathbf{i}}$</span> above order <span>$m$</span> are set to zero, approximating the probability distribution of the system with the normal distribution [2]:</p><p class="math-container">\[\begin{align*}
    \kappa_{\mathbf{i}} = 0, \quad \text{for} \; |\mathbf{i}| &gt; m.
\end{align*}\]</p><p>In order to truncate the higher order central or raw moments <span>$M_{\mathbf{i}}$</span> using normal closure we express them in terms of cumulants <span>$\kappa_{\mathbf{i}}$</span> using the multivariate moment and cumulant relationships formalised by Balakrishnan et al. [7].</p><p>Note that a different implementation of normal closure can be found in literature [3], where the higher order central moments are expressed in terms of a sum of product of covariances using <a href="https://en.wikipedia.org/wiki/Isserlis%27_theorem">Isserlis&#39; theorem</a>. However, one could argue that such formulation is not advisable as it assumes stronger &quot;Gaussianity&quot; of the underlying distribution than setting the higher order cumulants to zero which is less of an approximation on the form of the distribution and hence is preferable in the development of MAs. For example, in case we are truncating the moment equations at <span>$4$</span>th order, the truncation-order central moments would be expressed only in terms of covariances whereas our formulation using cumulants would explicitly include information about the computed values of third central moments, which is expected to improve numerical stability and lead to more accurate moment estimates.</p><h2 id="poisson_closure"><a class="docs-heading-anchor" href="#poisson_closure">Poisson Closure</a><a id="poisson_closure-1"></a><a class="docs-heading-anchor-permalink" href="#poisson_closure" title="Permalink"></a></h2><p>Although the Poisson distribution lacks a general formulation for multiple variables [3], &quot;Poisson MA&quot; has been formulated [2, 8] assuming that the joint multivariate distribution is a product of univariate Poisson distributions, i.e., <span>$n_i \sim \text{Poisson}(\mu_i)$</span>. The cumulants of a univariate Poisson distribution are equal to the mean, hence in Poisson closure we set all higher order diagonal cumulants to the corresponding mean values and mixed cumulants to zero [2], which in our notation can be expressed as:</p><p class="math-container">\[\begin{align*}
    \kappa_{\mathbf{i}} &amp;= \mu_j, \quad \text{if} \; i_{j} &gt; m \; \text{and} \; i_{j\neq k} = 0 \quad \text{for some} \; j, k \in \{1,\dotsc,N\}, \\
    \kappa_{\mathbf{i}} &amp;= 0, \quad \text{if} \;  |\mathbf{i}| &gt; m \; \text{and} \; i_{j} \neq i_{k} \; (\text{where} \; i_{j} \neq 0, i_{k} \neq 0) \quad \text{for some} \; j, k \in \{1,\dotsc,N\}
\end{align*}\]</p><p>Similarly to normal closure, the higher order central/raw moments can be expressed in terms of cumulants as described in [7].</p><h2 id="log-normal_closure"><a class="docs-heading-anchor" href="#log-normal_closure">Log-normal Closure</a><a id="log-normal_closure-1"></a><a class="docs-heading-anchor-permalink" href="#log-normal_closure" title="Permalink"></a></h2><p>&quot;Log-normal&quot; MA, first applied by Keeling [9], allows one to truncate the moment equations under the assumption that the distribution of the underlying stochastic process is log-normal. A positive multi-dimensional random variable <span>$\mathbf{n}$</span> follows a log-normal distribution if its logarithm is normally distributed, so that <span>$\mathbf{y} = \ln \mathbf{n}$</span>, and <span>$\mathbf{y} \sim \mathcal{N}(\mathbf{\nu}, \Sigma)$</span>, where <span>$\mathbf{\nu}$</span> and <span>$\Sigma$</span> denote the vector of means and the covariance matrix respectively. By considering the moment generating function of the normal distribution, <span>$\mathcal{N}(\mathbf{\nu}, \Sigma)$</span>, one can show that the raw moments are given by [3, 10]:</p><p class="math-container">\[\begin{align*}
    \mu_{\mathbf{i}} = \exp\left(\mathbf{i}^{\top}\mathbf{\nu} + \frac{1}{2}\mathbf{i}^{\top}\Sigma\mathbf{i}\right).
\end{align*}\]</p><p>It follows that</p><p class="math-container">\[\begin{align*}
    \nu_i &amp;= \ln \mu_i - \frac{1}{2} \Sigma_{ii}, \\
    \Sigma_{ij} &amp;= \ln \left( 1 + \frac{\langle (n_i - \mu_i)(n_j - \mu_j) \rangle}{\exp \left( \nu_i + \nu_j + \frac{1}{2} \left( \Sigma_{ii} + \Sigma_{jj} \right) \right)} \right)  \\
    &amp;= \ln \left( 1 + \frac{C_{ij}}{\exp \left( \nu_i + \nu_j + \frac{1}{2} \left( \Sigma_{ii} + \Sigma_{jj} \right) \right)} \right), \\
    \Sigma_{ii} &amp;= \ln \left( 1 + \frac{C_{ii}}{\mu_i^2}  \right) .
\end{align*}\]</p><p>Note that central moments can be obtained from raw moments by utilising their general multivariate relationship [11].</p><h2 id="gamma_closure"><a class="docs-heading-anchor" href="#gamma_closure">Gamma Closure</a><a id="gamma_closure-1"></a><a class="docs-heading-anchor-permalink" href="#gamma_closure" title="Permalink"></a></h2><p>The method of &quot;gamma closure&quot; was originally implemented by Lakatos et al. [3], where the authors acknowledged the ambiguity arising in defining multivariate gamma distributions, and, building upon previous definitions in the literature (e.g. [12] and [13]), proposed a new formulation of a multivariate gamma distribution. Here we reproduce the definition by closely following the description in [3] and elucidating some of the derivation steps.</p><p>We denote a random variable drawn from gamma distribution with shape <span>$\alpha$</span> and scale <span>$\beta$</span> as <span>$n \sim \text{Gamma}(\alpha, \beta)$</span>. The probability density function of the univariate gamma distribution with the corresponding shape-scale parameterisation is</p><p class="math-container">\[\begin{align*}
    f(n; \alpha, \beta) = \frac{1}{\Gamma(\alpha)\beta^{\alpha}} n^{\alpha-1}e^{-\frac{n}{\beta}},
\end{align*}\]</p><p>where <span>$\Gamma$</span> is the gamma function. The <span>$i^{\text{th}}$</span> raw moment of <span>$n$</span> is given by</p><p class="math-container">\[\begin{align*}
    μ_i &amp;= \frac{\Gamma(\alpha+i)\beta^i}{\Gamma(\alpha)} = (\alpha)_i \beta^i, \tag{a}
\end{align*}\]</p><p>where <span>$(\alpha)_i = \alpha (\alpha+1) \dotsm (\alpha+i-1)$</span>. Note that the moment generating function of X is</p><p class="math-container">\[\begin{align*}
    G_{n}(k) = \langle e^{kn} \rangle = \left( 1 - \beta k \right)^{-\alpha}.
\end{align*}\]</p><p>In order to construct a multivariate gamma distribution, we start by considering independent gamma variables <span>$Y_{kl}$</span>, <span>$k, l = 1, \dotsc, N$</span>, with shape and scale parameters <span>$\alpha_{kl}$</span> and <span>$\beta_{kl}$</span> respectively. Here we define <span>$Y_{kl}$</span> to be symmetric in indices, i.e., <span>$Y_{kl} = Y_{lk}$</span>. Now consider an <span>$N$</span>-dimensional random vector <span>$\mathbf{n} = \left( n_1, n_2, \dotsc, n_N \right)$</span>, where <span>$n_i$</span> is a linear combination of independent gamma variables:</p><p class="math-container">\[\begin{align*}
    n_i = \sum_{j=1}^N \frac{\beta_{ii}}{\beta_{ij}} Y_{ij}.
\end{align*}\]</p><p>The <span>$i^{\text{th}}$</span> marginal moment generating function of the joint distribution of <span>$\mathbf{n}$</span> is given by:</p><p class="math-container">\[\begin{align*}
    G_{n_i}(k_i) &amp;= \left\langle e^{k_i \sum_{j=1}^N \frac{\beta_{ii}}{\beta_{ij}}} \right\rangle  \\
                 &amp;= G_{Y_{i1}}\left(k_i \frac{\beta_{ii}}{\beta_{i1}} \right) G_{Y_{i2}}\left(k_i \frac{\beta_{ii}}{\beta_{i2}} \right) \dotsm G_{Y_{iN}}\left(k_i \frac{\beta_{ii}}{\beta_{iN}} \right)  \\
                 &amp;= \left(1-\beta_{ii} k_i \right)^{\sum_{j=1}^N \alpha_{ij}},
\end{align*}\]</p><p>so that <span>$n_i \sim \text{Gamma}(\alpha_i, \beta_i)$</span>, where <span>$\alpha_i = \sum_{j=1}^N \alpha_{ij}$</span> and <span>$\beta_i = \beta_{ii}$</span>. Therefore, we have obtained an <span>$N$</span>-variate gamma distribution, which can be denoted as <span>$\mathbf{n} \sim MG(\mathbf{\alpha}, \mathbf{\beta})$</span>, where the vectors of shape and scale parameters are given by <span>$\mathbf{\alpha} = \left( \alpha_1, \dotsc, \alpha_N \right)$</span> and <span>$\mathbf{\beta} = \left( \beta_1, \beta_2, \dotsc, \beta_N \right)$</span> respectively.</p><p>We can now readily obtain the raw <span>$m^{\text{th}}$</span> order moment of <span>$n_i$</span>:</p><p class="math-container">\[\begin{align*}
    \langle n_i^{m} \rangle &amp;= \left\langle \left( \sum_{j=1}^N \frac{\beta_{ii}}{\beta_{ij}} Y_{ij} \right)^m \right\rangle  \\
                            &amp;= \left\langle \sum_{k_1+k_2+\dotsb+k_N = m} \frac{m!}{k_1!k_2! \dotsm k_N!} \prod_{j=1}^N \left( \frac{\beta_{ii}}{\beta_{ij}} Y_{ij} \right)^{k_j} \right\rangle  \\
                            &amp;= \sum_{|\mathbf{k}|=m} \frac{m!}{\mathbf{k!}} \prod_{j=1}^N \left\langle \left( \frac{\beta_{ii}}{\beta_{ij}} Y_{ij} \right)^{k_j} \right\rangle  \\
                            &amp;= \beta_i^m \sum_{|\mathbf{k}|=m} \frac{m!}{\mathbf{k!}} \left(
                            \prod_{j=1}^N \left( \alpha_{ij} \right)_{k_j} \right).
\end{align*}\]</p><p>Note that we have used Eq. (<a href="#mjx-eqn-a">a</a>) to get to the last line. The mixed raw moments are computed in a similar fashion:</p><p class="math-container">\[\begin{align*}
    \mu_{\mathbf{i}} &amp;= \left\langle \left( \sum_{j=1}^N \frac{\beta_{11}}{\beta_{1j}}Y_{1j} \right)^{i_1} \dotsm \left( \sum_{j=1}^N \frac{\beta_{NN}}{\beta_{Nj}}Y_{Nj} \right)^{i_N} \right\rangle  \\
                &amp;= \mathbf{\beta}^{\mathbf{i}} \left\langle \sum_{|\mathbf{k_1}|=i_1} \dotsm \sum_{|\mathbf{k_N}|=i_N} \frac{\mathbf{i!}}{\mathbf{k_1!}\dotsm\mathbf{k_N!}} \prod_{j=1}^N \left(  \frac{Y_{1j}}{\beta_{1j}} \right)^{{k_1}_{j}} \dotsm \prod_{j=1}^N \left(  \frac{Y_{Nj}}{\beta_{Nj}} \right)^{{k_N}_{j}} \right\rangle  \\
                &amp;= \mathbf{\beta}^{\mathbf{i}} \left\langle \sum_{|\mathbf{k_1}|=i_1} \dotsm \sum_{|\mathbf{k_N}|=i_N} \frac{\mathbf{i!}}{\mathbf{k_1!}\dotsm\mathbf{k_N!}} \prod_{q=1}^{N} \left( \frac{Y_{qq}}{\beta_{qq}} \right)^{{k_q}_{q}} \prod_{r=q+1}^N \left( \frac{Y_{qr}}{\beta_{qr}} \right)^{{k_{q}}_{r} + {k_r}_q} \right\rangle  \\
                 &amp;= \mathbf{\beta}^{\mathbf{i}} \sum_{|\mathbf{k_1}|=i_1} \dotsm \sum_{|\mathbf{k_N}|=i_N} \frac{\mathbf{i!}}{\mathbf{k_1!}\dotsm\mathbf{k_N!}} \prod_{q=1}^{N} \left( \alpha_{qq} \right)_{{k_q}_{q}} \prod_{r=q+1}^N \left( \alpha_{qr} \right)_{{k_{q}}_{r} + {k_{r}}_{q}},
\end{align*}\]</p><p>where we have taken into account the symmetry in indices and defined each <span>$\mathbf{k_i}$</span> as an <span>$N$</span>-dimensional vector <span>$\mathbf{k_i} = \left( k_{i_{1}}, \dotsc, k_{i_{N}} \right)$</span> and <span>$\mathbf{\beta}^{\mathbf{i}} = \beta_1^{i_1} \dotsm \beta_N^{i_N}$</span>. Note that the mean and variance of <span>$n_i$</span> can be obtained from:</p><p class="math-container">\[\begin{align*}
    \mu_i  &amp;= \sum_{j=1}^N \alpha_{ij} \beta_i, \tag{b} \\
    C_{ii} &amp;= (\alpha_i)_2 \beta_i^2 - \alpha_i^2\beta_i^2  \\
           &amp;= \sum_{j=1}^N \alpha_{ij} \beta_i^2.
\end{align*}\]</p><p>Similarly, from Eq. (<a href="#mjx-eqn-a">a</a>) it follows that</p><p class="math-container">\[\begin{align*}
    \langle n_i n_j \rangle = \beta_i \beta_j \left( \sum_{\substack{k, l \\ (k, l) \neq (j, i)}}^N  \alpha_{ik} \alpha_{jl} + (\alpha_{ij})_2 \right),
\end{align*}\]</p><p>which together with Eq. (<a href="#mjx-eqn-b">b</a>) allows us to express the covariance as:</p><p class="math-container">\[\begin{align*}
    C_{ij} &amp;= \langle n_i n_j \rangle - \beta_i \beta_j \left( \sum_{k,l} \alpha_{ik} \alpha_{jl} \right)  \\
           &amp;= \alpha_{ij} \beta_i \beta_j.
\end{align*}\]</p><p>Finally, from the equations above we can obtain all shape and scale parameters:</p><p class="math-container">\[\begin{align*}
    \beta_i &amp;= \frac{C_{ii}}{\mu_i}, \\
    \alpha_{ij} &amp;= \frac{C_{ij}}{\beta_i \beta_j}, \\
    \alpha_{ii} &amp;= \frac{\mu_i}{\beta_i} - \sum_{\substack{k \\ k \neq i}} \alpha_{ik}.
\end{align*}\]</p><h2 id="derivative_matching"><a class="docs-heading-anchor" href="#derivative_matching">Derivative Matching</a><a id="derivative_matching-1"></a><a class="docs-heading-anchor-permalink" href="#derivative_matching" title="Permalink"></a></h2><p>The derivative matching MA [14, 15] is based on expressing moments above order <span>$m$</span> in terms of lower order moments in such a way that their time derivatives match those of the <em>exact</em> moments at some initial time and initial conditions. We outline the approach below, closely following the complete exposition found in the original papers of Singh and Hespanha [14, 15].</p><p>The <a href="../moment_expansion_CME/#raw_moment_eqs">raw moment equations</a> up to order <span>$m$</span> for any mass-action reaction network containing <em>at most</em> bimolecular (second order) reactions can be written down concisely in the matrix form:</p><p class="math-container">\[\begin{align*}
    \frac{d\mathbf{μ}}{dt} = \hat{\mathbf{a}} + A\mathbf{μ} + B \bar{\mathbf{μ}} \;,
\end{align*}\]</p><p>where <span>$\mathbf{μ}$</span> is a vector containing all raw moments of the system up to order <span>$m$</span> and <span>$\bar{\mathbf{μ}}$</span> consists of all <span>$(m+1)^{\text{th}}$</span> order raw moments which the equations depend on. The constant vector <span>$\hat{\mathbf{a}}$</span> and constant matrices <span>$A$</span> and <span>$B$</span> are chosen appropriately for the system at hand. In this case, an MA can be defined as a procedure where each moment in <span>$\bar{\mathbf{μ}}$</span>, <span>$\bar{μ}_{\mathbf{i}}$</span>, is approximated by a <em>moment closure function</em> <span>$\varphi_{\mathbf{i}} (\mathbf{μ})$</span> of moments up to order <span>$m$</span>. Then the moment equations can be rewritten as</p><p class="math-container">\[    \frac{d\mathbf{ν}}{dt} = \hat{\mathbf{a}} + A\mathbf{ν} + B\bar{\mathbf{φ}}(\mathbf{ν}) \;,\]</p><p>where the state of the system is now denoted by <span>$\mathbf{ν}$</span> instead of <span>$\mathbf{μ}$</span>, stressing the fact that we are considering the approximation of the true moment dynamics, and <span>$\bar{\mathbf{φ}}(\mathbf{ν})$</span> is the corresponding vector of moment closure functions.</p><p>The idea behind derivative matching is to determine a map <span>$\bar{\mathbf{φ}}$</span> so that the time derivatives between the exact moments, <span>$\mathbf{μ}(t)$</span>, and the approximate moments, <span>$\mathbf{ν}(t)$</span>, would match at some initial time <span>$t_0$</span> under the initial condition <span>$\mathbf{μ}(t_0) = \mathbf{ν}(t_0)$</span>:</p><p class="math-container">\[\begin{align*}
    \left. \frac{d^i \mathbf{μ}}{dt} \right\rvert_{t=t_0} = \left. \frac{d^i \mathbf{ν}}{dt} \right\rvert_{t=t_0}
\end{align*}\]</p><p>If these conditions hold, one can expect from a Taylor series approximation argument that <span>$\mathbf{μ}(t)$</span> and <span>$\mathbf{ν}(t)$</span> will stay close at least locally in time and hence the MA will be sufficiently accurate.</p><p>In order to move forward, Singh and Hespanha present what can be understood as essentially an ansatz. Firstly, moment closure functions for each <span>$\mathbf{i}$</span>, where <span>$|\mathbf{i}| &gt; m$</span>, are chosen to have a separable form given by</p><p class="math-container">\[\begin{align*}
    φ_{\mathbf{i}}(\mathbf{μ}) = \prod_{\substack{1 \leq j_1+\dotsb+j_N \leq m}} \left( μ_{\mathbf{j}} \right)^{γ_{\mathbf{j}}} = \prod_{|\mathbf{j}|=1}^{m} \left( μ_{\mathbf{j}} \right)^{γ_{\mathbf{j}}} \;,
\end{align*}\]</p><p>where <span>$γ_{\mathbf{j}}$</span> are constants (unique for each vector <span>$\mathbf{i}$</span>) that can be determined by solving the following linear equation system:</p><p class="math-container">\[\begin{align*}
    C^{\mathbf{i}}_{\mathbf{j}} = \sum_{|\mathbf{k}|=1}^m \gamma_{\mathbf{k}} C^{\mathbf{k}}_{\mathbf{j}} \;, \quad \text{for each } \mathbf{j} \; \text{where } |\mathbf{j}|\leq m \,,
\end{align*}\]</p><p>were we have introduced multi-index scalars</p><p class="math-container">\[\begin{align*}
    C^{\mathbf{u}}_{\mathbf{v}} &amp;= C^{u_1}_{v_1}C^{u_2}_{v_2} \dotsm C^{u_N}_{v_N},
\end{align*}\]</p><p>with each element defined as</p><p class="math-container">\[\begin{align*}
C^{a}_{b} &amp;=
\begin{cases}
  \frac{a!}{(a-b)!b!}, &amp; a \geq b \\
  0, &amp; a \lt b
\end{cases}\;.
\end{align*}\]</p><p>Using the specific construction of <span>$\bar{\mathbf{φ}}$</span> described above, it can be shown [15] that for every <em>deterministic</em> initial condition, i.e., <span>$\mathbf{n}(t_0) = \mathbf{n}_0$</span> with probability one, we will have</p><p class="math-container">\[\begin{align*}
    \mathbf{μ}(t_0) = \mathbf{ν}(t_0) &amp;\implies \left. \frac{d \mathbf{μ}}{dt} \right\rvert_{t=t_0} = \left. \frac{d \mathbf{ν}}{dt} \right\rvert_{t=t_0} \\
    &amp;\implies \left. \frac{d^2\mathbf{μ}}{dt^2} \right\rvert_{t=t_0} = \left. \frac{d^2 \mathbf{ν}}{dt^2} \right\rvert_{t=t_0} + \mathbf{ϵ}(\mathbf{n}_0) \;,
\end{align*}\]</p><p>where all elements of <span>$\mathbf{ϵ}(\mathbf{n}_0)$</span> are zero except the ones corresponding to <span>$m^{\text{th}}$</span> order raw moments—these elements are second order polynomials in <span>$\mathbf{n}_0$</span>. Note, however, that these results hold only for mass-action systems containing no higher than second order chemical reactions. While the derivative matching MA can be applied in the same way to systems containing higher order polynomial and non-polynomial propensity functions, it has not been rigorously analysed in such scenarios, where, naturally, we expect significantly larger approximation errors.</p><h2 id="conditional_closures"><a class="docs-heading-anchor" href="#conditional_closures">Conditional Closures</a><a id="conditional_closures-1"></a><a class="docs-heading-anchor-permalink" href="#conditional_closures" title="Permalink"></a></h2><p>As standard MAs often fail to provide sufficiently accurate approximations of chemical reaction networks involving both high- and low-abundance species, some novel approaches suggest using moments conditioned on the low-copy number species, which can lead to a more effective description of the system dynamics [1, 16]. Here we discuss the conditional moment closure proposed by Soltani et al. (2015) [16], applicable to networks containing molecular species which copy number can be either zero or one, i.e., a binary/Bernoulli random variable. Such conditional MA can be very useful in the study of gene networks where two-state gene systems are often considered—the gene state itself can be treated as a distinct species which molecule number is a Bernoulli variable.</p><p>The conditional MA is based on conditioning the higher order moments of high-abundance species on the binary species being in state 1 (instead of 0) and then applying standard MAs on the conditional moments. Closely following Soltani et al. [16], we use a two-state gene circuit to illustrate the conditional MAs, denoting the binary gene state by <span>$g$</span> and the protein number (high-abundance species) by <span>$p$</span>. Firstly, note that as <span>$g$</span> is a Bernoulli variable the following identities hold</p><p class="math-container">\[\begin{align*}
\langle g^j p \rangle &amp;= \langle g \rangle, \quad j \in {2, 3, \dotsc}, \\
\langle g^j p^k \rangle &amp;= \langle g p^k \rangle, \quad j,k \in {1, 2, 3, \dotsc}
\end{align*}\]</p><p>Therefore, we only need to concern ourselves with moments of the form <span>$\langle p^k \rangle$</span> and <span>$\langle gp^k \rangle$</span>. The former can be approximated using the standard MAs (no conditioning needed), whereas the latter can be written down as:</p><p class="math-container">\[\begin{align*}
\langle gp^j \rangle = \langle p^j \,|\, g=1 \rangle \langle g \rangle, \quad j\in \{1,2, \dotsc\}.
\end{align*}\]</p><p>Now the conditional moment <span>$\langle p^j \,|\, g= 1 \rangle$</span> can be expressed in terms of lower order conditional moments using one of the standard MAs, e.g., normal closure or derivative matching—the two methods (including the conditioning step) are respectively known as the <em>conditional gaussian</em> and <em>conditional derivative matching</em> MAs. For completeness, we show how the two methods are applied to approximate a specific higher order moment:</p><p class="math-container">\[\begin{align*}
    \langle gp^3 \rangle = \langle p^3 \,|\, g=1 \rangle \langle g \rangle.
\end{align*}\]</p><h3 id="conditional_gaussian_closure"><a class="docs-heading-anchor" href="#conditional_gaussian_closure">Conditional Gaussian Closure</a><a id="conditional_gaussian_closure-1"></a><a class="docs-heading-anchor-permalink" href="#conditional_gaussian_closure" title="Permalink"></a></h3><p>Under the conditional Gaussian MA, we assume that the number of protein molecules conditioned on the gene being active, <span>$p \,|\, g = 1$</span>, follows a Gaussian distribution. In other words, we apply <a href="#normal_closure">normal MA</a> on the conditional moment <span>$\langle p^j \,|\, g=1 \rangle$</span>. Hence we obtain (following the example above):</p><p class="math-container">\[\begin{align*}
\langle p^3 \,|\, g= 1 \rangle = 3 \langle p^2 \,|\, g = 1 \rangle \langle p \,|\, g=1 \rangle - 2 \langle p \,|\, g=1 \rangle^3.
\end{align*}\]</p><p>Using <span>$\langle gp^j \rangle = \langle p^j \,|\, g=1 \rangle \langle g \rangle$</span>, we can rewrite the equation as:</p><p class="math-container">\[\begin{align*}
\langle p^3 \,|\, g= 1 \rangle = 3 \frac{\langle gp^2 \rangle \langle gp \rangle}{\langle g \rangle^2} - 2 \frac{\langle gp \rangle^3}{\langle g \rangle^3}.
\end{align*}\]</p><p>Plugging this into the previous expression of the higher-order moment <span>$\langle gp^3 \rangle$</span> we finally obtain:</p><p class="math-container">\[\begin{align*}
    \langle gp^3 \rangle = 3 \frac{\langle gp^2 \rangle \langle gp \rangle}{\langle g \rangle} - 2 \frac{\langle gp \rangle^3}{\langle g \rangle^2}.
\end{align*}\]</p><h3 id="conditional_derivative_matching"><a class="docs-heading-anchor" href="#conditional_derivative_matching">Conditional Derivative Matching</a><a id="conditional_derivative_matching-1"></a><a class="docs-heading-anchor-permalink" href="#conditional_derivative_matching" title="Permalink"></a></h3><p>The conditional derivative matching boils down to approximating the higher order conditional moments in terms of lower order conditional moments using the standard <a href="#derivative_matching">derivative matching</a>:</p><p class="math-container">\[\begin{align*}
\langle p^3 \,|\, g = 1 \rangle = \frac{\langle p^2 \,|\, g = 1 \rangle^3}{\langle p \,|\, g= 1 \rangle^3}.
\end{align*}\]</p><p>Using <span>$\langle gp^j \rangle = \langle p^j \,|\, g=1 \rangle \langle g \rangle$</span> again, we find:</p><p class="math-container">\[\begin{align*}
\langle gp^3 \rangle = \frac{\langle gp^2 \rangle^3 \langle g \rangle}{\langle gp \rangle^3}.
\end{align*}\]</p><p>Note that conditional moment closure is fully applicable to systems containing multiple binary species. For example, given two two-state genes, <span>$g_1$</span> and <span>$g_2$</span>, the same Bernoulli variable properties hold and the higher-order moments can be expressed as:</p><p class="math-container">\[\begin{align*}
\langle g_1 g_2 p^j \rangle = \langle p^j \,|\, g_1 = g_2 = 1 \rangle \langle g_1 g_2 \rangle, \quad j \in \{1,2,\dotsc\}.
\end{align*}\]</p><p>Such higher order conditional moments can again be closed using normal closure or derivative matching.</p><p>Note that the description here is taken from [16] and we urge the reader to see the paper for more details. In addition, we have used MomentClosure to apply conditional closures on genetic feedback loops and reproduce some of the published results in <a href="../../tutorials/geometric_reactions+conditional_closures/#geometric-and-conditional">this example</a>.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><p>[1]: D. Schnoerr, G. Sanguinetti, and R. Grima, &quot;Approximation and inference methods for stochastic biochemical kinetics - a tutorial review&quot;, Journal of Physics A: Mathematical and Theoretical 50, 093001 (2017). <a href="https://doi.org/10.1088/1751-8121/aa54d9">https://doi.org/10.1088/1751-8121/aa54d9</a></p><p>[2]: D. Schnoerr, G. Sanguinetti, and R. Grima, &quot;Comparison of different moment-closure approximations for stochastic chemical kinetics&quot;, The Journal of Chemical Physics 143, 185101 (2015). <a href="https://doi.org/10.1063/1.4934990">https://doi.org/10.1063/1.4934990</a></p><p>[3]: E. Lakatos, A. Ale, P. D. W. Kirk, and M. P. H. Stumpf, &quot;Multivariate moment closure techniques for stochastic kinetic models&quot;, The Journal of Chemical Physics 143, 094107 (2015). <a href="https://doi.org/10.1063/1.4929837">https://doi.org/10.1063/1.4929837</a></p><p>[4]: J.  Hespanha,  &quot;Moment  closure  for  biochemical  networks&quot;,  in  2008  3rd  International Symposium on Communications, Control and Signal Processing (Mar. 2008), pp. 142–147. <a href="https://doi.org/10.1109/ISCCSP.2008.4537208">https://doi.org/10.1109/ISCCSP.2008.4537208</a></p><p>[5]: L. A. Goodman, &quot;Population Growth of the Sexes&quot;, Biometrics 9, Publisher: [Wiley, International Biometric Society], 212–225 (1953). <a href="https://doi.org/10.2307/3001852">https://doi.org/10.2307/3001852</a></p><p>[6]: P. Whittle, &quot;On the use of the normal approximation in the treatment of stochastic processes&quot;, Journal of the Royal Statistical Society: Series B (Methodological) 19, 268–281 (1957). <a href="https://doi.org/10.1111/j.2517-6161.1957.tb00263.x">https://doi.org/10.1111/j.2517-6161.1957.tb00263.x</a></p><p>[7]: N. Balakrishnan, N. L. Johnson, and S. Kotz, “A note on relationships between moments, central moments and cumulants from multivariate distributions”, Statistics &amp; Probability Letters 39, 49–54 (1998). <a href="https://doi.org/10.1016/S0167-7152(98)00027-3">https://doi.org/10.1016/S0167-7152(98)00027-3</a></p><p>[8]: I. Nasell, &quot;An extension of the moment closure method&quot;, Theoretical Population Biology 64, 233–239 (2003). <a href="https://doi.org/10.1016/S0040-5809(03)00074-1">https://doi.org/10.1016/S0040-5809(03)00074-1</a></p><p>[9]: M. J. Keeling, &quot;Multiplicative Moments and Measures of Persistence in Ecology&quot;, Journal of Theoretical Biology 205, 269–281 (2000). <a href="https://doi.org/10.1006/jtbi.2000.2066">https://doi.org/10.1006/jtbi.2000.2066</a></p><p>[10]: E. L. Crow and K. Shimizu, eds., Lognormal Distributions: Theory and Applications (Marcel Dekker, 1988).</p><p>[11]: N. L. Johnson, S. Kotz, and N. Balakrishnan, Discrete Multivariate Distributions (Wiley, Feb. 1997).</p><p>[12]: A. M. Mathal and P. G. Moschopoulos, &quot;A form of multivariate gamma distribution&quot;, Annals of the Institute of Statistical Mathematics 44, 97–106 (1992). <a href="https://doi.org/10.1007/BF00048672">https://doi.org/10.1007/BF00048672</a></p><p>[13]: E. Furman, &quot;On a multivariate gamma distribution&quot;, Statistics &amp; Probability Letters 78, 2353–2360 (2008). <a href="https://doi.org/10.1016/j.spl.2008.02.012">https://doi.org/10.1016/j.spl.2008.02.012</a></p><p>[14]: A.  Singh  and  J.  P.  Hespanha,  &quot;Lognormal  Moment  Closures  for  Biochemical  Reactions&quot;, in Proceedings of the 45th IEEE Conference on Decision and Control, ISSN:0191-2216 (Dec. 2006), pp. 2063–2068. <a href="https://doi.org/10.1109/CDC.2006.376994">https://doi.org/10.1109/CDC.2006.376994</a></p><p>[15]: A. Singh and J. P. Hespanha, &quot;Approximate Moment Dynamics for Chemically Reacting Systems&quot;, IEEE Transactions on Automatic Control 56, 414–418 (2011). <a href="https://doi.org/10.1109/TAC.2010.2088631">https://doi.org/10.1109/TAC.2010.2088631</a></p><p>[16]: M. Soltani, C. A. Vargas-Garcia, and A. Singh, &quot;Conditional Moment Closure Schemes for Studying Stochastic Dynamics of Genetic Circuits&quot;, IEEE Transactions on Biomedical Circuits and Systems 9, 518–526 (2015). <a href="https://doi.org/10.1109/tbcas.2015.2453158">https://doi.org/10.1109/tbcas.2015.2453158</a></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../moment_expansion_SDE/">« Moment Expansion (SDE)</a><a class="docs-footer-nextpage" href="../linear_mapping_approximation/">Linear Mapping Approximation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.4 on <span class="colophon-date" title="Thursday 29 May 2025 12:27">Thursday 29 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
